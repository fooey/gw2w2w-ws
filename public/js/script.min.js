/*! grunt-uglify gw2w2w-ws - v0.0.1 - 2014-01-29 */


/*!
*
*   APP
*
*/
window.modules=window.modules||{},$(function(){function a(a){switch(a.event){case"desync":case"resync":case"reset":window.modules.util.reloadDelayed()}}console.log("******************"),console.log("*  Starting App  *"),console.log("******************"),window.webSocketChannel=window.webSocketChannel||"loading",window.modules.ws.subscribeToChannel(window.webSocketChannel),window.modules.ws.addListener(["desync","resync","reset"],a)}),/*!
*
*	APP.LIB
*
*/
function(a){"use strict";function b(a){d.waitingForReload||(d.waitingForReload=!0,console.log("Reloading in %d ms",a),setTimeout(function(){$.ajax({url:window.location,type:"head",timeout:3e3}).done(function(){window.location.reload()}).fail(function(){console.log("*********************************"),console.log(" App not ready, requeuing reload "),console.log("*********************************"),d.waitingForReload=!1,c.reloadDelayed(4e3,8e3)})},a))}var c={};a.util=c;var d={waitingForReload:!1};$(function(){});c.reloadDelayed=function(a,c){a&&!c?c=a:a||c||(c=c||100,a=a||300);var d=d||_.random(a,c);b(d)},c.isJSON=function(a){var b=!1;try{var c=$.parseJSON(a);b="object"==typeof c}catch(d){}return b},c.minuteFormat=function(a){var b=Math.floor(a/60);a-=60*b,a="00"+a,a=a.substring(a.length-2,a.length);var c=b+":"+a;return c},c.dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,e=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};return function(f,g,h){var i=c.dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(f)||/\d/.test(f)||(g=f,f=void 0),f=f?new Date(f):new Date,isNaN(f))throw SyntaxError("invalid date");g=String(i.masks[g]||g||i.masks["default"]),"UTC:"==g.slice(0,4)&&(g=g.slice(4),h=!0);var j=h?"getUTC":"get",k=f[j+"Date"](),l=f[j+"Day"](),m=f[j+"Month"](),n=f[j+"FullYear"](),o=f[j+"Hours"](),p=f[j+"Minutes"](),q=f[j+"Seconds"](),r=f[j+"Milliseconds"](),s=h?0:f.getTimezoneOffset(),t={d:k,dd:e(k),ddd:i.i18n.dayNames[l],dddd:i.i18n.dayNames[l+7],m:m+1,mm:e(m+1),mmm:i.i18n.monthNames[m],mmmm:i.i18n.monthNames[m+12],yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:e(o%12||12),H:o,HH:e(o),M:p,MM:e(p),s:q,ss:e(q),l:e(r,3),L:e(r>99?Math.round(r/10):r),t:12>o?"a":"p",tt:12>o?"am":"pm",T:12>o?"A":"P",TT:12>o?"AM":"PM",Z:h?"UTC":(String(f).match(b)||[""]).pop().replace(d,""),o:(s>0?"-":"+")+e(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:["th","st","nd","rd"][k%10>3?0:(k%100-k%10!=10)*k%10]};return g.replace(a,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();c.dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},c.dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}(window.modules),/*!
*
*   APP.WSCLIENT
*
*/
function(a){"use strict";function b(a){i.channel=a,i.client=new WebSocket(k()),i.client.onclose=d,i.client.onmessage=e,i.client.onopen=c}function c(){var a={event:"subscribe",channel:i.channel};console.log("WS Send:",a),i.client.send(JSON.stringify(a))}function d(){window.modules.util.reloadDelayed()}function e(a){var b=a.data;window.modules.util.isJSON(b)&&(b=JSON.parse(b)),Array.isArray(b)||(b=[b]),async.eachSeries(b,function(a,b){a.event=a.event||"global",g(a,b)},function(){_.defer(window.modules.guilds.setPendingGuilds)})}function f(a){return j[a]}function g(a,b){var c=f(a.event);c&&c.length?async.each(c,function(b,c){b(a),c(null)},b):b(null)}var h={};a.ws=h;var i={},j={};h.subscribeToChannel=function(a){b(a)},h.addListener=function(a,b){_.isArray(a)?async.each(a,function(a,c){h.addListener(a,b),c(null)},_.noop):(j[a]=j[a]||[],j[a].push(b))};var k=_.memoize(function(){return["ws://",window.location.hostname,":",window.location.port].join("")})}(window.modules),/*!
*
*   APP.OVERVIEW
*
*/
function(a){"use strict";function b(){async.each(g.find(".pie"),function(a,b){c($(a)),b(null)},_.noop)}function c(a){var b=a.closest(".match"),c=b.data("matchid"),d=b.find(".world.red"),e=d.find("a").text(),f=d.find(".score").data("score")||0,g=b.find(".world.blue"),i=g.find("a").text(),j=g.find(".score").data("score")||0,k=b.find(".world.green"),l=k.find("a").text(),m=k.find(".score").data("score")||0,n=google.visualization.arrayToDataTable([["Team","Score"],[e,f],[i,j],[l,m]]);async.nextTick(function(){new google.visualization.PieChart(document.getElementById("pie"+c)).draw(n,h.chartOptions)})}function d(a){console.log("update match scores",a.arguments);var b=a.arguments,d=$("#match"+b.matchId);async.each(d.find(".world"),function(a,c){var d=$(a),f=d.find(".score"),g=d.data("worldindex"),h=f.data("score"),i=b.scores[g],j=i-h,k=Humanize.intcomma(i);f.data("score",i).text(k),j&&e(f,j),c(null)},function(){async.nextTick(c.bind(null,d.find(".pie")))})}function e(a,b){a.prepend($("<span>",{"class":"score-diff",text:"+"+b}).fadeIn(250,function(){$(this).animate({left:"0",opacity:0,"font-size":"45px"},750,function(){$(this).remove()})}))}var f={};a.overview=f;var g,h={chartOptions:{width:90,height:90,chartArea:{width:"100%",height:"100%"},colors:["#a94442","#31708f","#3c763d"],enableInteractivity:!1,pieSliceText:"none",legend:{position:"none"},tooltip:{textStyle:{fontSize:"9"}}}};$(function(){g=$(".overview"),g.length&&(window.modules.ws.addListener("updateScore",d),b())})}(window.modules),/*!
*
*   APP.TRACKER
*
*/
function(a){"use strict";var b={};a.tracker=b;var c;$(function(){c=$("#tracker")})}(window.modules),/*!
*
*   APP.TRACKER.SCOREBOARD
*
*/
function(a){"use strict";function b(a){var b=a.arguments;console.log("update match scores",b.scores),async.each($("#scoreBoards").find(".teamScoreBoard"),function(a,c){var d=$(a),e=d.data("worldindex"),f=Humanize.intcomma(b.scores[e]);d.find(".score").text(f),c(null)},_.noop)}var c={};a.trackerScoreboard=c;$(function(){window.modules.ws.addListener("updateScore",b)})}(window.modules),/*!
*
*   APP.TRACKER.OBJECTIVES
*
*/
function(a){"use strict";function b(){var a=300,b=Math.floor(Date.now()/1e3);async.each(j,function(c,d){var e=$(c),f=e.data("timestamp"),g=b-f;if(a>g){var h=window.modules.util.minuteFormat(a-g-serverTimeOffset);e.find(".timer").show().html(h)}else e.find(".timer:visible").hide().text("");d(null)},_.noop)}function c(a){var b=window.gw2data.objectives[a],c=window.gw2data.state[a],d=c.owner.color.toLowerCase(),e=c.owner.timestamp;console.log("UPDATE :: New objective owner",b.commonNames[urlLang],c.owner,c.guild),k(a).removeClass("red green blue neutral").addClass(d).data("timestamp",e).find(".sprite").removeClass("red green blue neutral").addClass(d).end()}function d(a){var b=window.gw2data.objectives[a],c=window.gw2data.state[a];if(c.guild.id){console.log("UPDATE :: New objective claimer",b.commonNames[urlLang],c.owner,c.guild);var d=$("<abbr>",{"class":"guild",data:{guild:c.guild.id},text:"Loading..."});k(a).append(d),window.modules.guilds.setGuild(d)}}function e(a){var b=window.gw2data.objectives[a],c=window.gw2data.state[a],d=k(a),e=!(!d.find(".guild").length&&!d.data("guild")),f=e&&d.data("guild")===c.guild.id;e&&!f&&(console.log("UPDATE :: Remove objective claimer",b.commonNames[urlLang],c.owner,c.guild),d.find(".guild").remove().end().data("guild",null))}function f(a){var b=a.arguments;window.gw2data.state[b.objectiveId].owner={color:b.owner,timestamp:b.timestamp},async.series([function(a){c(b.objectiveId),a(null)},function(a){e(b.objectiveId),a(null)},function(a){d(b.objectiveId),a(null)}])}function g(a){var b=a.arguments;window.gw2data.state[b.objectiveId].guild={id:b.guild,timestamp:b.timestamp},d(b.objectiveId)}function h(a){var b=a.arguments;window.gw2data.state[b.objectiveId].guild={},e(b.objectiveId)}var i={};a.trackerObjectives=i;var j;$(function(){j=$("#objectives").find(".objective"),j.length&&(setInterval(b,1e3/3),window.modules.ws.addListener("newOwner",f),window.modules.ws.addListener("newClaimer",g),window.modules.ws.addListener("dropClaimer",h))});var k=i.$getObjective=_.memoize(function(a){return j.filter("#objective-"+a)})}(window.modules),/*!
*
*   APP.TRACKER.GUILDS
*
*/
function(a){"use strict";var b={};a.guilds=b;$(function(){_.defer(c)});var c=b.setPendingGuilds=function(){var a=$(".guild:not(.guildSet)");async.eachSeries(a,function(a,b){d($(a)),b(null)},_.noop)},d=b.setGuild=function(a){var b=a.data("guild");if(b){var c=window.gw2data.guilds[b];c?(a.addClass("guildSet"),a.hasClass("guildFull")?a.text("["+c.tag+"] "+c.guild_name):a.text(c.tag).attr("title",c.guild_name)):(a.text("loading..."),$.getJSON("/data/guild-"+b+".json").done(function(c){window.gw2data.guilds[b]=c,console.log("New Guild Data: ",a,c),d(a)}).fail(function(b,c,d){console.log("Guild Data Failed: ",a,d)}))}else console.log(a,b)}}(window.modules),/*!
*
*   APP.TRACKER.LOG
*
*/
function(a){"use strict";function b(a,b,e){var f=window.gw2data.objectives[a],g=window.gw2data.objectiveTypes[f.type];if(g.timer){var h=window.gw2data.state[a],i=window.gw2data.objectiveGroups[a],j=h.owner.color.toLowerCase(),k=h.owner.timestamp,l=q.find("li.active a").data("mapname"),m=c(g.type,j),n=$("<div>",{"class":["logEntry","team","clearfix",j,i.mapName,"objective-"+a].join(" "),data:{timestamp:k,objectiveid:f.id,mapname:""}}).append($("<div>",{"class":"logCol timetext"})).append($("<div>",{"class":"logCol logSprite"}).append(m)).append($("<div>",{"class":"logCol objName",text:f.commonNames[urlLang]})).append($("<div>",{"class":"logCol mapName",text:i.mapName})).append($("<div>",{"class":"logCol details"}).append(e)).hide();n.prependTo(p),("All"===l||l===i.mapName)&&(n.slideDown(),d())}}function c(a,b){return $("<span>",{"class":["sprite",a,b].join(" ")})}function d(){p.find(".logEntry").removeClass("alt").filter(":visible:even").addClass("alt")}function e(a){p.find(a).slideUp(function(){$(this).remove()})}function f(){var a=p.find(".logEntry");async.each(a,function(a,b){var c=$(a),d=c.data("timestamp")-serverTimeOffset,e=new Date(1e3*d),f=window.modules.util.dateFormat(e,"hh:MM:ss"),g=Humanize.naturalTime(d);c.find(".timetext").html(g).attr("title",f),b(null)},_.noop)}function g(){o.on("mouseenter",".logEntry",h).on("mouseleave",".logEntry",i),q.on("click","a",j)}function h(){var a=$(this),b=a.data("objectiveid"),c=window.modules.trackerObjectives.$getObjective(b);c.addClass("active")}function i(){var a=$(this),b=a.data("objectiveid"),c=window.modules.trackerObjectives.$getObjective(b);c.removeClass("active")}function j(a){a.preventDefault();var b=$(this),c=b.data("mapname");b.closest("li").addClass("active").siblings().removeClass("active"),"All"===c?o.find(".logEntry:hidden").show().end():o.find(".logEntry:not(."+c+")").hide().end().find(".logEntry."+c).show().end(),d()}function k(a){var c=a.arguments;e(".objective-"+c.objectiveId);var d=$("<span>",{text:"newOwner: "+c.owner});b(c.objectiveId,a.event,d)}function l(a){var c=a.arguments;e(".claimer.objective-"+c.objectiveId);var d=$("<span>",{"class":"guild guildFull",data:{guild:c.guild},text:c.guild}),f=$("<span>",{text:"newClaimer: "}).append(d);b(c.objectiveId,a.event,f)}function m(a){var c=a.arguments;e(".claimer.objective-"+c.objectiveId);var d=$("<span>",{text:"removeClaimer: "+c.objectiveId});b(c.objectiveId,a.event,d)}var n={};a.trackerLog=n;var o,p,q;$(function(){o=$("#log"),p=$("#logEntries"),q=$("#logtabs"),o.length&&(g(),d(),setInterval(f,1e3/3),window.modules.ws.addListener("newOwner",k),window.modules.ws.addListener("newClaimer",l),window.modules.ws.addListener("dropClaimer",m))})}(window.modules);
//# sourceMappingURL=/js/script.map.js