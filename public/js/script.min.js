/*! grunt-uglify gw2w2w-ws - v0.0.1 - 2014-01-17 */


/*!
*
*   APP
*
*/
window.modules=window.modules||{},$(function(){function a(a){switch(a.event){case"desync":case"resync":case"reset":window.modules.util.reloadDelayed()}}window.webSocketChannel=window.webSocketChannel||"loading",window.modules.ws.subscribeToChannel(window.webSocketChannel),window.modules.ws.addListener(["desync","resync","reset"],a)}),/*!
*
*	APP.LIB
*
*/
function(a){"use strict";function b(a){d.waitingForReload||(d.waitingForReload=!0,console.log("Reloading in %d ms",a),$("#priorityAlert").slideDown("fast"),setTimeout(function(){$("#priorityAlert").find("h3").fadeOut("fast",function(){$(this).remove()}),$.ajax({url:window.location,type:"head",timeout:3e3}).done(function(){window.location.reload()}).fail(function(){console.log("*********************************"),console.log(" App not ready, requeuing reload "),console.log("*********************************"),$("#priorityAlert").css({minHeight:"160px"}).append($("<h3>Application unavailable, requeuing page reload...</h3>").hide().fadeIn("fast")),d.waitingForReload=!1,c.reloadDelayed(4e3,8e3)})},a))}var c={};a.util=c;var d={waitingForReload:!1};$(function(){$('<div id="priorityAlert" class="alert alert-danger" style="margin: 1em 0; padding: 1em; text-align: center; vertical-align: middle;"><h1>Application has requested a page reload</h1></div>').hide().prependTo("#content")}),c.reloadDelayed=function(a,c){a&&!c?c=a:a||c||(c=c||100,a=a||300);var d=d||randRange(a,c);b(d)},c.isJSON=function(a){var b=!1;try{var c=$.parseJSON(a);b="object"==typeof c}catch(d){}return b},c.minuteFormat=function(a){var b=Math.floor(a/60);a-=60*b,a="00"+a,a=a.substring(a.length-2,a.length);var c=b+":"+a;return c},c.dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};return function(e,f,g){var h=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(f=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),"UTC:"==f.slice(0,4)&&(f=f.slice(4),g=!0);var i=g?"getUTC":"get",j=e[i+"Date"](),k=e[i+"Day"](),l=e[i+"Month"](),m=e[i+"FullYear"](),n=e[i+"Hours"](),o=e[i+"Minutes"](),p=e[i+"Seconds"](),q=e[i+"Milliseconds"](),r=g?0:e.getTimezoneOffset(),s={d:j,dd:d(j),ddd:h.i18n.dayNames[k],dddd:h.i18n.dayNames[k+7],m:l+1,mm:d(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(m).slice(2),yyyy:m,h:n%12||12,hh:d(n%12||12),H:n,HH:d(n),M:o,MM:d(o),s:p,ss:d(p),l:d(q,3),L:d(q>99?Math.round(q/10):q),t:12>n?"a":"p",tt:12>n?"am":"pm",T:12>n?"A":"P",TT:12>n?"AM":"PM",Z:g?"UTC":(String(e).match(b)||[""]).pop().replace(c,""),o:(r>0?"-":"+")+d(100*Math.floor(Math.abs(r)/60)+Math.abs(r)%60,4),S:["th","st","nd","rd"][j%10>3?0:(j%100-j%10!=10)*j%10]};return f.replace(a,function(a){return a in s?s[a]:a.slice(1,a.length-1)})}}(),c.dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},c.dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}(window.modules),/*!
*
*   APP.WSCLIENT
*
*/
function(a){"use strict";function b(a){i.channel=a,i.client=new WebSocket(k()),i.client.onclose=d,i.client.onmessage=e,i.client.onopen=c}function c(){var a={event:"subscribe",channel:i.channel};console.log("WS Send:",a),i.client.send(JSON.stringify(a))}function d(){window.modules.util.reloadDelayed()}function e(a){var b=a.data;console.log("Recieved WS Message: ",b),window.modules.util.isJSON(b)&&(b=JSON.parse(b)),Array.isArray(b)||(b=[b]),async.each(b,function(a,b){a.event=a.event||"global",g(a),b(null)},_.noop)}function f(a){return j[a]}function g(a){var b=f(a.event);b&&b.length&&async.each(b,function(b,c){b(a),c(null)},_.noop)}var h={};a.ws=h;var i={},j={};h.subscribeToChannel=function(a){b(a)},h.addListener=function(a,b){_.isArray(a)?async.each(a,function(a,c){h.addListener(a,b),c(null)},_.noop):(j[a]=j[a]||[],j[a].push(b))};var k=_.memoize(function(){return["ws://",window.location.hostname,":",window.location.port].join("")})}(window.modules),/*!
*
*   APP.OVERVIEW
*
*/
function(a){"use strict";function b(){async.each(g.find(".pie"),function(a,b){c($(a)),b(null)},_.noop)}function c(a){var b=a.closest(".match"),c=b.data("matchid"),d=b.find(".world.red"),e=d.find("a").text(),f=d.find(".score").data("score")||0,g=b.find(".world.blue"),i=g.find("a").text(),j=g.find(".score").data("score")||0,k=b.find(".world.green"),l=k.find("a").text(),m=k.find(".score").data("score")||0,n=google.visualization.arrayToDataTable([["Team","Score"],[e,f],[i,j],[l,m]]);async.nextTick(function(){new google.visualization.PieChart(document.getElementById("pie"+c)).draw(n,h.chartOptions)})}function d(a){console.log("update match scores",a.arguments);var b=a.arguments,d=$("#match"+b.matchId);async.each(d.find(".world"),function(a,c){var d=$(a),f=d.find(".score"),g=d.data("worldindex"),h=f.data("score"),i=b.scores[g],j=i-h,k=Humanize.intcomma(i);f.data("score",i).text(k),j&&e(f,j),c(null)},function(){async.nextTick(c.bind(null,d.find(".pie")))})}function e(a,b){a.prepend($("<span>",{"class":"score-diff",text:"+"+b}).fadeIn(250,function(){$(this).animate({left:"0",opacity:0,"font-size":"45px"},750,function(){$(this).remove()})}))}var f={};a.overview=f;var g,h={chartOptions:{width:90,height:90,chartArea:{width:"100%",height:"100%"},colors:["#a94442","#31708f","#3c763d"],enableInteractivity:!1,pieSliceText:"none",legend:{position:"none"},tooltip:{textStyle:{fontSize:"9"}}}};$(function(){g=$(".overview"),g.length&&(window.modules.ws.addListener("updateScore",d),b())})}(window.modules),/*!
*
*   APP.TRACKER
*
*/
function(a){"use strict";var b={};a.tracker=b;var c;$(function(){c=$("#tracker")})}(window.modules),/*!
*
*   APP.TRACKER.SCOREBOARD
*
*/
function(a){"use strict";function b(a){var b=a.arguments;console.log("update match scores",b.scores),async.each($("#scoreBoards").find(".teamScoreBoard"),function(a,c){var d=$(a),e=d.data("worldindex"),f=Humanize.intcomma(b.scores[e]);d.find(".score").text(f),c(null)},_.noop)}var c={};a.trackerScoreboard=c;$(function(){window.modules.ws.addListener("updateScore",b)})}(window.modules),/*!
*
*   APP.TRACKER.OBJECTIVES
*
*/
function(a){"use strict";function b(){var a=300,b=Math.floor(Date.now()/1e3);async.each(h,function(c,d){var e=$(c),f=e.data("lastcaptured"),g=b-f;if(a>g){var h=window.modules.util.minuteFormat(a-g);e.find(".timer").show().html(h)}else e.find(".timer:visible").hide().text("");d(null)},_.noop)}function c(a){var b=window.gw2data.objectives[a],c=window.gw2data.state[a],d=c.owner.color.toLowerCase(),e=c.owner.timestamp,f=$("#objective-"+a),g=f.find(".sprite");console.log("update objective owner",b.commonNames[urlLang],c.owner.color),f.removeClass("red green blue neutral").addClass(d).data("lastcaptured",e),g.removeClass("red green blue neutral").addClass(d)}function d(a){var b=a.arguments;window.gw2data.state[b.objectiveId].owner={color:b.owner,timestamp:b.timestamp},c(b.objectiveId)}function e(a){var b=a.arguments;window.gw2data.state[b.objectiveId].guild={id:b.guild,timestamp:b.timestamp}}function f(a){var b=a.arguments;window.gw2data.state[b.objectiveId].guild={}}var g={};a.trackerObjectives=g;var h;$(function(){h=$("#objectives").find(".objectives"),h.length&&(setInterval(b,1e3/3),window.modules.ws.addListener("newOwner",d),window.modules.ws.addListener("newClaimer",e),window.modules.ws.addListener("dropClaimer",f))})}(window.modules),/*!
*
*   APP.TRACKER.LOG
*
*/
function(a){"use strict";function b(a,b,e){var f=window.gw2data.objectives[a],g=window.gw2data.objectiveTypes[f.type];if(g.timer){var h=window.gw2data.state[a],i=window.gw2data.objectiveGroups[a],j=h.owner.color.toLowerCase(),k=h.owner.timestamp,l=p.find("li.active a").data("mapname"),m=c(g.type,j),n=$("<div>",{"class":["logEntry","team","clearfix",j,i.mapName,"objective-"+a].join(" "),data:{timestamp:k,objectiveid:f.id,mapname:""}}).append($("<div>",{"class":"logCol timestamp"})).append($("<div>",{"class":"logCol timetext"})).append($("<div>",{"class":"logCol logSprite"}).append(m)).append($("<div>",{"class":"logCol objName",text:f.commonNames[urlLang]})).append($("<div>",{"class":"logCol mapName",text:i.mapName})).append($("<div>",{"class":"logCol details",text:e})).hide();n.prependTo(o),("All"===l||l===i.mapName)&&(n.slideDown(),d())}}function c(a,b){return $("<span>",{"class":["sprite",a,b].join(" ")})}function d(){o.find(".logEntry").removeClass("alt").filter(":visible:even").addClass("alt")}function e(a){o.find(a).slideUp(function(){$(this).remove()})}function f(){var a=o.find(".logEntry");async.each(a,function(a,b){var c=$(a),d=c.data("timestamp"),e=new Date(1e3*d),f=window.modules.util.dateFormat(e,"hh:MM:ss"),g=Humanize.naturalTime(d);c.find(".timestamp").html(f),c.find(".timetext").html(g),b(null)},_.noop)}function g(){n.on("mouseenter mouseleave",".logEntry",h),p.on("click","a",i)}function h(){var a=$(this),b=a.data("objectiveid"),c=$("#objective-"+b);c.toggleClass("active")}function i(a){a.preventDefault();var b=$(this),c=b.data("mapname");b.closest("li").addClass("active").siblings().removeClass("active"),"All"===c?n.find(".logEntry:hidden").show().end():n.find(".logEntry:not(."+c+")").hide().end().find(".logEntry."+c).show().end(),d()}function j(a){var c=a.arguments;e(".objective-"+c.objectiveId),b(c.objectiveId,a.event,"newOwner: "+c.owner)}function k(a){var c=a.arguments;e(".claimer.objective-"+c.objectiveId),b(c.objectiveId,a.event,"newClaimer: "+c.guild)}function l(a){var c=a.arguments;e(".claimer.objective-"+c.objectiveId),b(c.objectiveId,a.event,"removeClaimer: "+c.objectiveId)}var m={};a.trackerLog=m;var n,o,p;$(function(){n=$("#log"),o=$("#logEntries"),p=$("#logtabs"),n.length&&(g(),d(),setInterval(f,1e3/3),window.modules.ws.addListener("newOwner",j),window.modules.ws.addListener("newClaimer",k),window.modules.ws.addListener("dropClaimer",l))})}(window.modules);
//# sourceMappingURL=/js/script.map.js