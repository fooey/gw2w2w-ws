extends layout


block content
		.row: .col-md-12.text-center: a(href="/"): img.block-center.img-responsive(src="/images/logo-512x192.png")
		br
		section.row
			.col-md-6
				h2.page-header() US Matches
				+writeMatches(matches.US)
			.col-md-6 
				h2.page-header() EU Matches
				+writeMatches(matches.EU)

		section.row
			.col-md-6
				h3.page-header US Worlds
				+writeWorlds(worlds.US)
			.col-md-6
				h3.page-header EU Worlds
				+writeWorlds(worlds.EU)


block bodyClose
	script.
		$(function(){subscribeToUpdates('overview')});




mixin writeMatches(matches)
	section.overview
		-var matchNum = 0;
		each match in matches
			-matchNum++;
			//-tr: td(colspan=3)= match.getId()
			-console.log('match:', match)
			.match.row(id="match"+ match.id)
				.worlds.col-md-9.col-xs-9
					each world, worldIndex in [match.redWorld, match.blueWorld, match.greenWorld]
						-var team = ['red', 'blue', 'green'][worldIndex];
						.world.row(id="world"+ world.id, class=['team', team])
							.name.col-md-9.col-xs-9
								a(href=world.link, class=['team', team])= world.name
							.score.col-md-3.col-xs-3(data-score= match.scores[worldIndex])
								= match.scoresFormatted[worldIndex]

				.col-md-3.col-xs-3.pie
					canvas(width="90", height="90")
			//-
				each world, worldIndex in [match.redWorld, match.blueWorld, match.greenWorld]
					-var team = ['red', 'blue', 'green'][worldIndex];
					-var trClass = ['group' + (matchNum%2), 'match' + match.id, 'team', team];
					-var aClass = ['team', team].join(' ');
					-var scoreNumeric = match.scores[worldIndex];
					-var scoreFormatted = match.scoresFormatted[worldIndex];
					tr(id='world' + world.id, class=trClass)
						td.name:  a(href=world.link, class=aClass)= world.name
						td.score(data-score=scoreNumeric)= scoreFormatted
						if(worldIndex === 0)
							td.pie(rowspan=3, align="center", valign="center")


mixin writeWorlds(worlds)
	ul
		each world in worlds
			li: a(href=world.link)= world.name
